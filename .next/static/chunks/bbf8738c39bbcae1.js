(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},43531,4421,20682,e=>{"use strict";let t,r,s,a,n=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>n],43531);var l,o=e.i(71645);let i=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e))},l=t=e(s,a,n);return n},c=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>c(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>c(t)(e)}}},d=(t=(l=(s=(e,t)=>({selectedItems:[],customItems:[],contentBySection:{},currentStep:0,selectItem:t=>e(e=>e.selectedItems.find(e=>e.id===t.id)?e:{selectedItems:[...e.selectedItems,t]}),deselectItem:t=>e(e=>({selectedItems:e.selectedItems.filter(e=>e.id!==t)})),addCustomItem:t=>e(e=>{let r={id:`custom-${Date.now()}`,name:t,completed:!1};return{customItems:[...e.customItems,r]}}),removeCustomItem:t=>e(e=>({customItems:e.customItems.filter(e=>e.id!==t)})),updateContent:(t,r,s)=>e(e=>({contentBySection:{...e.contentBySection,[t]:{method:r,text:s}}})),markSectionComplete:t=>e(e=>({selectedItems:e.selectedItems.map(e=>e.id===t?{...e,completed:!0}:e),customItems:e.customItems.map(e=>e.id===t?{...e,completed:!0}:e)})),setCurrentStep:t=>e({currentStep:t}),resetReport:()=>e({selectedItems:[],customItems:[],contentBySection:{},currentStep:0}),reorderSections:t=>{e(e=>({selectedItems:t.filter(t=>e.selectedItems.some(e=>e.id===t.id)),customItems:t.filter(t=>e.customItems.some(e=>e.id===t.id))}))},getCompletionStatus:()=>{let e=t(),r=[...e.selectedItems,...e.customItems],s=r.filter(t=>e.contentBySection[t.id]?.text).length;return{total:r.length,completed:s,percentage:r.length>0?Math.round(s/r.length*100):0}}}),a={name:"report-store",version:1},(e,t,r)=>{let n,l={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let s=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(s):s(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...a},o=!1,i=new Set,d=new Set,m=l.storage;if(!m)return s((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),e(...t)},t,r);let u=()=>{let e=l.partialize({...t()});return m.setItem(l.name,{state:e,version:l.version})},p=r.setState;r.setState=(e,t)=>(p(e,t),u());let h=s((...t)=>(e(...t),u()),t,r);r.getInitialState=()=>h;let f=()=>{var r,s;if(!m)return;o=!1,i.forEach(e=>{var r;return e(null!=(r=t())?r:h)});let a=(null==(s=l.onRehydrateStorage)?void 0:s.call(l,null!=(r=t())?r:h))||void 0;return c(m.getItem.bind(m))(l.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];else{if(l.migrate){let t=l.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(r=>{var s;let[a,o]=r;if(e(n=l.merge(o,null!=(s=t())?s:h),!0),a)return u()}).then(()=>{null==a||a(n,void 0),n=t(),o=!0,d.forEach(e=>e(n))}).catch(e=>{null==a||a(void 0,e)})};return r.persist={setOptions:e=>{l={...l,...e},e.storage&&(m=e.storage)},clearStorage:()=>{null==m||m.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>f(),hasHydrated:()=>o,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},l.skipHydration||f(),n||h}))?i(l):i,Object.assign(r=e=>(function(e,t=e=>e){let r=o.default.useSyncExternalStore(e.subscribe,o.default.useCallback(()=>t(e.getState()),[e,t]),o.default.useCallback(()=>t(e.getInitialState()),[e,t]));return o.default.useDebugValue(r),r})(t,e),t),r);e.s(["useReportStore",0,d],4421);let m=0,u=new Map,p=e=>{if(u.has(e))return;let t=setTimeout(()=>{u.delete(e),x({type:"REMOVE_TOAST",toastId:e})},1e6);u.set(e,t)},h=[],f={toasts:[]};function x(e){f=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?p(r):e.toasts.forEach(e=>{p(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(f,e),h.forEach(e=>{e(f)})}function g({...e}){let t=(m=(m+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>x({type:"DISMISS_TOAST",toastId:t});return x({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>x({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function y(){let[e,t]=o.useState(f);return o.useEffect(()=>(h.push(t),()=>{let e=h.indexOf(t);e>-1&&h.splice(e,1)}),[e]),{...e,toast:g,dismiss:e=>x({type:"DISMISS_TOAST",toastId:e})}}e.s(["useToast",()=>y],20682)},63209,44215,e=>{"use strict";let t=(0,e.i(75254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);async function r(e){let t=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt})});if(!t.ok)throw Error((await t.json()).error||"Failed to generate content");return(await t.json()).content}async function s(e){let t=new FormData;t.append("file",e.file);let r=await fetch("/api/extract",{method:"POST",body:t});if(!r.ok)throw Error((await r.json()).error||"Failed to extract content from file");return(await r.json()).content}async function a(e){let t=await fetch("/api/compile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:e.sections})});if(!t.ok){let e=await t.json().catch(()=>({error:"Failed to compile report"}));throw Error(e.error||e.details||"Failed to compile report")}let r=t.headers.get("content-type");if(r?.includes("application/pdf")){let e=await t.blob();return t.headers.get("content-disposition")?.match(/filename="?(.+)"?/)?.[1],{success:!0,downloadUrl:URL.createObjectURL(e),message:"Report compiled successfully",blob:e}}{let e=await t.json();return{success:e.success,downloadUrl:e.downloadUrl||(e.pdfBase64?`data:application/pdf;base64,${e.pdfBase64}`:""),message:e.message||"Report compiled successfully",pdfBase64:e.pdfBase64}}}e.s(["AlertCircle",()=>t],63209),e.s(["compileReport",()=>a,"extractFromFile",()=>s,"generateContent",()=>r],44215)},59331,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(75254);let n=(0,a.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),l=(0,a.default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var o=e.i(43531),i=e.i(63209);let c=(0,a.default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var d=e.i(67881),m=e.i(70065),u=e.i(63780),p=e.i(4421),h=e.i(20682),f=e.i(44215);function x(){let e=(0,s.useRouter)(),{toast:a}=(0,h.useToast)(),{selectedItems:x,customItems:g,contentBySection:y,reorderSections:v,resetReport:b}=(0,p.useReportStore)(),[j,w]=(0,r.useState)([...x,...g]),[S,N]=(0,r.useState)(null),[k,C]=(0,r.useState)(!1),[I,T]=(0,r.useState)(!0),O=j.every(e=>y[e.id]?.text),R=e=>{e.preventDefault(),e.currentTarget.style.backgroundColor="var(--color-muted)"},E=e=>{e.currentTarget.style.backgroundColor="transparent"},U=async()=>{C(!0);try{let e=j.map(e=>({name:e.name,content:y[e.id]?.text||"",id:e.id})),t=await (0,f.compileReport)({sections:e});if(!t.success)throw Error(t.message||"Failed to compile report");if(!t.downloadUrl&&!t.blob)throw Error("No download URL or blob received from server");try{let e=t.blob||(t.downloadUrl&&t.downloadUrl.startsWith("blob:")?await fetch(t.downloadUrl).then(e=>e.blob()):null);if(e){let t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`kisaanmittr-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}else if(t.downloadUrl&&t.downloadUrl.startsWith("data:application/pdf;base64,")){let e=t.downloadUrl.split(",")[1],r=atob(e),s=Array(r.length);for(let e=0;e<r.length;e++)s[e]=r.charCodeAt(e);let a=new Uint8Array(s),n=new Blob([a],{type:"application/pdf"}),l=URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.download=`kisaanmittr-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}else if(t.downloadUrl)window.open(t.downloadUrl,"_blank");else throw Error("No valid download method available");a({title:"Success",description:"Report downloaded successfully"})}catch(e){throw console.error("Download error:",e),e}}catch(e){a({title:"Error",description:e instanceof Error?e.message:"Failed to download report",variant:"destructive"})}finally{C(!1)}},A=async()=>{if(!O)return void a({title:"Error",description:"All sections must have content before finalizing",variant:"destructive"});C(!0);try{let t=j.map(e=>({name:e.name,content:y[e.id]?.text||"",id:e.id}));await (0,f.compileReport)({sections:t}),a({title:"Success",description:"Report finalized successfully"}),setTimeout(()=>{b(),e.push("/")},1500)}catch(e){a({title:"Error",description:e instanceof Error?e.message:"Failed to finalize report",variant:"destructive"})}finally{C(!1)}};return 0===j.length?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(u.Navbar,{}),(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)(m.Card,{children:(0,t.jsxs)(m.CardContent,{className:"pt-6",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"No sections to review"}),(0,t.jsx)(d.Button,{onClick:()=>e.push("/report"),className:"mt-4 w-full",children:"Go Back"})]})})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(u.Navbar,{}),(0,t.jsxs)("main",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Review & Finalize Report"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Reorder sections, review content, and finalize your agricultural report"})]}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-1",children:[(0,t.jsxs)(m.Card,{children:[(0,t.jsxs)(m.CardHeader,{children:[(0,t.jsx)(m.CardTitle,{className:"text-lg",children:"Sections"}),(0,t.jsx)(m.CardDescription,{children:"Drag to reorder"})]}),(0,t.jsx)(m.CardContent,{className:"space-y-2",children:j.map(e=>{let r=y[e.id]?.text;return(0,t.jsxs)("div",{draggable:!0,onDragStart:()=>{N(e)},onDragOver:R,onDragLeave:E,onDrop:t=>((e,t)=>{if(e.preventDefault(),e.currentTarget.style.backgroundColor="transparent",!S||S.id===t.id)return;let r=j.findIndex(e=>e.id===S.id),s=j.findIndex(e=>e.id===t.id),n=Array.from(j);n.splice(r,1),n.splice(s,0,S),w(n),v(n),N(null),a({title:"Success",description:"Section reordered"})})(t,e),className:"flex items-center gap-2 rounded-md border p-3 bg-card hover:bg-muted cursor-move transition-colors",children:[(0,t.jsx)(l,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:e.name})}),r&&(0,t.jsx)(o.Check,{className:"h-4 w-4 text-primary shrink-0"})]},e.id)})})]}),(0,t.jsx)(m.Card,{className:"mt-4",children:(0,t.jsxs)(m.CardContent,{className:"pt-6 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Sections"}),(0,t.jsx)("span",{className:"font-semibold text-foreground",children:j.length})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"With Content"}),(0,t.jsx)("span",{className:"font-semibold text-foreground",children:j.filter(e=>y[e.id]?.text).length})]})]})})]}),(0,t.jsx)("div",{className:"lg:col-span-3",children:(0,t.jsxs)(m.Card,{className:"flex flex-col h-full",children:[(0,t.jsxs)(m.CardHeader,{className:"flex flex-row items-center justify-between border-b",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(m.CardTitle,{children:"Report Preview"}),(0,t.jsx)(m.CardDescription,{children:"Review how your report will look"})]}),(0,t.jsxs)(d.Button,{variant:"outline",size:"sm",onClick:()=>T(!I),className:"gap-2",children:[(0,t.jsx)(c,{className:"h-4 w-4"}),I?"Hide":"Show"]})]}),I&&(0,t.jsx)(m.CardContent,{className:"flex-1 overflow-auto py-6",children:(0,t.jsx)("div",{className:"space-y-8 max-w-2xl mx-auto",children:j.map((e,r)=>{let s=y[e.id]?.text;return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary text-sm font-semibold text-primary-foreground shrink-0",children:r+1}),(0,t.jsx)("h2",{className:"text-xl font-bold text-foreground pt-1",children:e.name})]}),s?(0,t.jsx)("div",{className:"ml-11 text-foreground whitespace-pre-wrap text-sm leading-relaxed bg-muted/30 p-4 rounded-lg",children:s}):(0,t.jsxs)("div",{className:"ml-11 rounded-lg bg-amber-50 dark:bg-amber-950 p-4 flex gap-2",children:[(0,t.jsx)(i.AlertCircle,{className:"h-4 w-4 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5"}),(0,t.jsx)("span",{className:"text-sm text-amber-800 dark:text-amber-200",children:"No content added"})]}),r<j.length-1&&(0,t.jsx)("div",{className:"ml-11 border-b border-border my-6"})]},e.id)})})}),!I&&(0,t.jsx)(m.CardContent,{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,t.jsx)("p",{children:"Preview hidden"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:'Click "Show" to view the report preview'})]})}),(0,t.jsxs)("div",{className:"border-t p-6 space-y-3",children:[!O&&(0,t.jsxs)("div",{className:"rounded-lg bg-red-50 dark:bg-red-950 p-4 flex gap-3",children:[(0,t.jsx)(i.AlertCircle,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),(0,t.jsx)("div",{className:"text-sm text-red-800 dark:text-red-200",children:"All sections must have content before finalizing the report"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>e.push("/report/content"),className:"flex-1",children:"Back to Editing"}),(0,t.jsxs)(d.Button,{onClick:U,disabled:k||!O,className:"flex-1 gap-2",children:[(0,t.jsx)(n,{className:"h-4 w-4"}),k?"Downloading...":"Download Report"]}),(0,t.jsx)(d.Button,{onClick:A,disabled:k||!O,className:"flex-1 bg-secondary hover:bg-secondary/90",children:k?"Processing...":"Finalize Report"})]})]})]})})]})]})]})}e.s(["default",()=>x],59331)}]);