module.exports=[87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},33441,68515,77687,a=>{"use strict";let b,c,d,e,f=(0,a.i(70106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>f],33441);var g,h=a.i(72131);let i=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},j=a=>b=>{try{let c=a(b);if(c instanceof Promise)return c;return{then:a=>j(a)(c),catch(a){return this}}}catch(a){return{then(a){return this},catch:b=>j(b)(a)}}},k=(b=(g=(d=(a,b)=>({selectedItems:[],customItems:[],contentBySection:{},currentStep:0,selectItem:b=>a(a=>a.selectedItems.find(a=>a.id===b.id)?a:{selectedItems:[...a.selectedItems,b]}),deselectItem:b=>a(a=>({selectedItems:a.selectedItems.filter(a=>a.id!==b)})),addCustomItem:b=>a(a=>{let c={id:`custom-${Date.now()}`,name:b,completed:!1};return{customItems:[...a.customItems,c]}}),removeCustomItem:b=>a(a=>({customItems:a.customItems.filter(a=>a.id!==b)})),updateContent:(b,c,d)=>a(a=>({contentBySection:{...a.contentBySection,[b]:{method:c,text:d}}})),markSectionComplete:b=>a(a=>({selectedItems:a.selectedItems.map(a=>a.id===b?{...a,completed:!0}:a),customItems:a.customItems.map(a=>a.id===b?{...a,completed:!0}:a)})),setCurrentStep:b=>a({currentStep:b}),resetReport:()=>a({selectedItems:[],customItems:[],contentBySection:{},currentStep:0}),reorderSections:b=>{a(a=>({selectedItems:b.filter(b=>a.selectedItems.some(a=>a.id===b.id)),customItems:b.filter(b=>a.customItems.some(a=>a.id===b.id))}))},getCompletionStatus:()=>{let a=b(),c=[...a.selectedItems,...a.customItems],d=c.filter(b=>a.contentBySection[b.id]?.text).length;return{total:c.length,completed:d,percentage:c.length>0?Math.round(d/c.length*100):0}}}),e={name:"report-store",version:1},(a,b,c)=>{let f,g={storage:function(a,b){let c;try{c=a()}catch(a){return}return{getItem:a=>{var b;let d=a=>null===a?null:JSON.parse(a,void 0),e=null!=(b=c.getItem(a))?b:null;return e instanceof Promise?e.then(d):d(e)},setItem:(a,b)=>c.setItem(a,JSON.stringify(b,void 0)),removeItem:a=>c.removeItem(a)}}(()=>localStorage),partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...e},h=!1,i=new Set,k=new Set,l=g.storage;if(!l)return d((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${g.name}', the given storage is currently unavailable.`),a(...b)},b,c);let m=()=>{let a=g.partialize({...b()});return l.setItem(g.name,{state:a,version:g.version})},n=c.setState;c.setState=(a,b)=>(n(a,b),m());let o=d((...b)=>(a(...b),m()),b,c);c.getInitialState=()=>o;let p=()=>{var c,d;if(!l)return;h=!1,i.forEach(a=>{var c;return a(null!=(c=b())?c:o)});let e=(null==(d=g.onRehydrateStorage)?void 0:d.call(g,null!=(c=b())?c:o))||void 0;return j(l.getItem.bind(l))(g.name).then(a=>{if(a)if("number"!=typeof a.version||a.version===g.version)return[!1,a.state];else{if(g.migrate){let b=g.migrate(a.state,a.version);return b instanceof Promise?b.then(a=>[!0,a]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(c=>{var d;let[e,h]=c;if(a(f=g.merge(h,null!=(d=b())?d:o),!0),e)return m()}).then(()=>{null==e||e(f,void 0),f=b(),h=!0,k.forEach(a=>a(f))}).catch(a=>{null==e||e(void 0,a)})};return c.persist={setOptions:a=>{g={...g,...a},a.storage&&(l=a.storage)},clearStorage:()=>{null==l||l.removeItem(g.name)},getOptions:()=>g,rehydrate:()=>p(),hasHydrated:()=>h,onHydrate:a=>(i.add(a),()=>{i.delete(a)}),onFinishHydration:a=>(k.add(a),()=>{k.delete(a)})},g.skipHydration||p(),f||o}))?i(g):i,Object.assign(c=a=>(function(a,b=a=>a){let c=h.default.useSyncExternalStore(a.subscribe,h.default.useCallback(()=>b(a.getState()),[a,b]),h.default.useCallback(()=>b(a.getInitialState()),[a,b]));return h.default.useDebugValue(c),c})(b,a),b),c);a.s(["useReportStore",0,k],68515);let l=0,m=new Map,n=a=>{if(m.has(a))return;let b=setTimeout(()=>{m.delete(a),q({type:"REMOVE_TOAST",toastId:a})},1e6);m.set(a,b)},o=[],p={toasts:[]};function q(a){p=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,1)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":{let{toastId:c}=b;return c?n(c):a.toasts.forEach(a=>{n(a.id)}),{...a,toasts:a.toasts.map(a=>a.id===c||void 0===c?{...a,open:!1}:a)}}case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)}}})(p,a),o.forEach(a=>{a(p)})}function r({...a}){let b=(l=(l+1)%Number.MAX_SAFE_INTEGER).toString(),c=()=>q({type:"DISMISS_TOAST",toastId:b});return q({type:"ADD_TOAST",toast:{...a,id:b,open:!0,onOpenChange:a=>{a||c()}}}),{id:b,dismiss:c,update:a=>q({type:"UPDATE_TOAST",toast:{...a,id:b}})}}function s(){let[a,b]=h.useState(p);return h.useEffect(()=>(o.push(b),()=>{let a=o.indexOf(b);a>-1&&o.splice(a,1)}),[a]),{...a,toast:r,dismiss:a=>q({type:"DISMISS_TOAST",toastId:a})}}a.s(["useToast",()=>s],77687)},92e3,71630,a=>{"use strict";let b=(0,a.i(70106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);async function c(a){let b=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a.prompt})});if(!b.ok)throw Error((await b.json()).error||"Failed to generate content");return(await b.json()).content}async function d(a){let b=new FormData;b.append("file",a.file);let c=await fetch("/api/extract",{method:"POST",body:b});if(!c.ok)throw Error((await c.json()).error||"Failed to extract content from file");return(await c.json()).content}async function e(a){let b=await fetch("/api/compile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:a.sections})});if(!b.ok){let a=await b.json().catch(()=>({error:"Failed to compile report"}));throw Error(a.error||a.details||"Failed to compile report")}let c=b.headers.get("content-type");if(c?.includes("application/pdf")){let a=await b.blob();return b.headers.get("content-disposition")?.match(/filename="?(.+)"?/)?.[1],{success:!0,downloadUrl:URL.createObjectURL(a),message:"Report compiled successfully",blob:a}}{let a=await b.json();return{success:a.success,downloadUrl:a.downloadUrl||(a.pdfBase64?`data:application/pdf;base64,${a.pdfBase64}`:""),message:a.message||"Report compiled successfully",pdfBase64:a.pdfBase64}}}a.s(["AlertCircle",()=>b],92e3),a.s(["compileReport",()=>e,"extractFromFile",()=>d,"generateContent",()=>c],71630)},98095,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(70106);let f=(0,e.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),g=(0,e.default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var h=a.i(33441),i=a.i(92e3);let j=(0,e.default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var k=a.i(40695),l=a.i(3130),m=a.i(10815),n=a.i(68515),o=a.i(77687),p=a.i(71630);function q(){let a=(0,d.useRouter)(),{toast:e}=(0,o.useToast)(),{selectedItems:q,customItems:r,contentBySection:s,reorderSections:t,resetReport:u}=(0,n.useReportStore)(),[v,w]=(0,c.useState)([...q,...r]),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!0),D=v.every(a=>s[a.id]?.text),E=a=>{a.preventDefault(),a.currentTarget.style.backgroundColor="var(--color-muted)"},F=a=>{a.currentTarget.style.backgroundColor="transparent"},G=async()=>{A(!0);try{let a=v.map(a=>({name:a.name,content:s[a.id]?.text||"",id:a.id})),b=await (0,p.compileReport)({sections:a});if(!b.success)throw Error(b.message||"Failed to compile report");if(!b.downloadUrl&&!b.blob)throw Error("No download URL or blob received from server");try{let a=b.blob||(b.downloadUrl&&b.downloadUrl.startsWith("blob:")?await fetch(b.downloadUrl).then(a=>a.blob()):null);if(a){let b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`kisaanmittr-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b)}else if(b.downloadUrl&&b.downloadUrl.startsWith("data:application/pdf;base64,")){let a=b.downloadUrl.split(",")[1],c=atob(a),d=Array(c.length);for(let a=0;a<c.length;a++)d[a]=c.charCodeAt(a);let e=new Uint8Array(d),f=new Blob([e],{type:"application/pdf"}),g=URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=`kisaanmittr-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g)}else if(b.downloadUrl)window.open(b.downloadUrl,"_blank");else throw Error("No valid download method available");e({title:"Success",description:"Report downloaded successfully"})}catch(a){throw console.error("Download error:",a),a}}catch(a){e({title:"Error",description:a instanceof Error?a.message:"Failed to download report",variant:"destructive"})}finally{A(!1)}},H=async()=>{if(!D)return void e({title:"Error",description:"All sections must have content before finalizing",variant:"destructive"});A(!0);try{let b=v.map(a=>({name:a.name,content:s[a.id]?.text||"",id:a.id}));await (0,p.compileReport)({sections:b}),e({title:"Success",description:"Report finalized successfully"}),setTimeout(()=>{u(),a.push("/")},1500)}catch(a){e({title:"Error",description:a instanceof Error?a.message:"Failed to finalize report",variant:"destructive"})}finally{A(!1)}};return 0===v.length?(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(m.Navbar,{}),(0,b.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,b.jsx)(l.Card,{children:(0,b.jsxs)(l.CardContent,{className:"pt-6",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"No sections to review"}),(0,b.jsx)(k.Button,{onClick:()=>a.push("/report"),className:"mt-4 w-full",children:"Go Back"})]})})})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(m.Navbar,{}),(0,b.jsxs)("main",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,b.jsxs)("div",{className:"mb-8 space-y-2",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Review & Finalize Report"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Reorder sections, review content, and finalize your agricultural report"})]}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-4",children:[(0,b.jsxs)("div",{className:"lg:col-span-1",children:[(0,b.jsxs)(l.Card,{children:[(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Sections"}),(0,b.jsx)(l.CardDescription,{children:"Drag to reorder"})]}),(0,b.jsx)(l.CardContent,{className:"space-y-2",children:v.map(a=>{let c=s[a.id]?.text;return(0,b.jsxs)("div",{draggable:!0,onDragStart:()=>{y(a)},onDragOver:E,onDragLeave:F,onDrop:b=>((a,b)=>{if(a.preventDefault(),a.currentTarget.style.backgroundColor="transparent",!x||x.id===b.id)return;let c=v.findIndex(a=>a.id===x.id),d=v.findIndex(a=>a.id===b.id),f=Array.from(v);f.splice(c,1),f.splice(d,0,x),w(f),t(f),y(null),e({title:"Success",description:"Section reordered"})})(b,a),className:"flex items-center gap-2 rounded-md border p-3 bg-card hover:bg-muted cursor-move transition-colors",children:[(0,b.jsx)(g,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:a.name})}),c&&(0,b.jsx)(h.Check,{className:"h-4 w-4 text-primary shrink-0"})]},a.id)})})]}),(0,b.jsx)(l.Card,{className:"mt-4",children:(0,b.jsxs)(l.CardContent,{className:"pt-6 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Sections"}),(0,b.jsx)("span",{className:"font-semibold text-foreground",children:v.length})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"With Content"}),(0,b.jsx)("span",{className:"font-semibold text-foreground",children:v.filter(a=>s[a.id]?.text).length})]})]})})]}),(0,b.jsx)("div",{className:"lg:col-span-3",children:(0,b.jsxs)(l.Card,{className:"flex flex-col h-full",children:[(0,b.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between border-b",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.CardTitle,{children:"Report Preview"}),(0,b.jsx)(l.CardDescription,{children:"Review how your report will look"})]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>C(!B),className:"gap-2",children:[(0,b.jsx)(j,{className:"h-4 w-4"}),B?"Hide":"Show"]})]}),B&&(0,b.jsx)(l.CardContent,{className:"flex-1 overflow-auto py-6",children:(0,b.jsx)("div",{className:"space-y-8 max-w-2xl mx-auto",children:v.map((a,c)=>{let d=s[a.id]?.text;return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary text-sm font-semibold text-primary-foreground shrink-0",children:c+1}),(0,b.jsx)("h2",{className:"text-xl font-bold text-foreground pt-1",children:a.name})]}),d?(0,b.jsx)("div",{className:"ml-11 text-foreground whitespace-pre-wrap text-sm leading-relaxed bg-muted/30 p-4 rounded-lg",children:d}):(0,b.jsxs)("div",{className:"ml-11 rounded-lg bg-amber-50 dark:bg-amber-950 p-4 flex gap-2",children:[(0,b.jsx)(i.AlertCircle,{className:"h-4 w-4 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5"}),(0,b.jsx)("span",{className:"text-sm text-amber-800 dark:text-amber-200",children:"No content added"})]}),c<v.length-1&&(0,b.jsx)("div",{className:"ml-11 border-b border-border my-6"})]},a.id)})})}),!B&&(0,b.jsx)(l.CardContent,{className:"flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,b.jsx)("p",{children:"Preview hidden"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:'Click "Show" to view the report preview'})]})}),(0,b.jsxs)("div",{className:"border-t p-6 space-y-3",children:[!D&&(0,b.jsxs)("div",{className:"rounded-lg bg-red-50 dark:bg-red-950 p-4 flex gap-3",children:[(0,b.jsx)(i.AlertCircle,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),(0,b.jsx)("div",{className:"text-sm text-red-800 dark:text-red-200",children:"All sections must have content before finalizing the report"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>a.push("/report/content"),className:"flex-1",children:"Back to Editing"}),(0,b.jsxs)(k.Button,{onClick:G,disabled:z||!D,className:"flex-1 gap-2",children:[(0,b.jsx)(f,{className:"h-4 w-4"}),z?"Downloading...":"Download Report"]}),(0,b.jsx)(k.Button,{onClick:H,disabled:z||!D,className:"flex-1 bg-secondary hover:bg-secondary/90",children:z?"Processing...":"Finalize Report"})]})]})]})})]})]})]})}a.s(["default",()=>q],98095)}];

//# sourceMappingURL=_c27166e5._.js.map